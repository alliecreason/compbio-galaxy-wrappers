<tool id="gatk4_collectrnaseqmetrics" name="CollectRnaSeqMetrics" version="@VERSION@.0" profile="17.09">
    <description>- Collect RnaSeq Metrics</description>

    <macros>
        <import>macros.xml</import>
    </macros>

    @VERSION_CMD@

    <command detect_errors="exit_code"><![CDATA[
        @CMD_BEGIN@ CollectRnaSeqMetrics
        -I ${input}
        -O ${output}
        --REF_FLAT ${refflat}
        --STRAND_SPECIFICITY ${strand_specificity}
        #if $ribosomal_intervals:
        --RIBOSOMAL_INTERVALS ${ribosomal_intervals}
        #end if
        #include source=$bam_opt_opts#
    ]]></command>

    <inputs>
        <expand macro="bam_req_params" />
        <param name="refflat" type="data" format="txt" label="Gene annotations in refFlat form."/>
        <param name="strand_specificity" type="select" label="For strand-specific library prep.">
            <option value="NONE">NONE</option>
            <option value="FIRST_READ_TRANSCRIPTION_STRAND">FIRST_READ_TRANSCRIPTION_STRAND</option>
            <option value="SECOND_READ_TRANSCRIPTION_STRAND">SECOND_READ_TRANSCRIPTION_STRAND</option>
        </param>
        <param name="ribosomal_intervals" type="data" format="gatk_intervals" optional="true" label="Location of rRNA sequences in genome, in interval_list format."/>
        <expand macro="bam_opt_params" />
    </inputs>

    <outputs>
        <data format="txt" name="output" label="${tool.name} on ${on_string}: RnaSeq Metrics" from_work_dir="output.RNA_Metrics"/>
    </outputs>

    <help><![CDATA[
        This tool takes a SAM/BAM file containing the aligned reads from an RNAseq experiment and produces metrics describing the distribution of the bases within the transcripts. It calculates the total numbers and the fractions of nucleotides within specific genomic regions including untranslated regions (UTRs), introns, intergenic sequences (between discrete genes), and peptide-coding sequences (exons). This tool also determines the numbers of bases that pass quality filters that are specific to Illumina data (PF_BASES). For more information please see the corresponding GATK Dictionary entry.

Other metrics include the median coverage (depth), the ratios of 5 prime /3 prime-biases, and the numbers of reads with the correct/incorrect strand designation. The 5 prime /3 prime-bias results from errors introduced by reverse transcriptase enzymes during library construction, ultimately leading to the over-representation of either the 5 prime or 3 prime ends of transcripts. Please see the CollectRnaSeqMetrics definitions for details on how these biases are calculated.

The sequence input must be a valid SAM/BAM file containing RNAseq data aligned by an RNAseq-aware genome aligner such a STAR or TopHat. The tool also requires a REF_FLAT file, a tab-delimited file containing information about the location of RNA transcripts, exon start and stop sites, etc. For an example refFlat file for GRCh38, see refFlat.txt.gz at http://hgdownload.cse.ucsc.edu/goldenPath/hg38/database. The first five lines of the tab-limited text file appear as follows.

    @PICARD_HELP@
    ]]></help>

    <expand macro="citations" />

</tool>
